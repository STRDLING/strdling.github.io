<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 Controls - Race Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* General page and layout styles */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #492833, #201C1C);
            min-height: 100vh;
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
        }

        /* Styles for the mobile navigation menu */
        #mobile-menu {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            position: absolute;
            width: 100%;
            left: 0;
            top: 100%;
            background-color: #492833;
        }
        #mobile-menu.menu-open {
            max-height: 25rem;
            opacity: 1;
        }
        .hamburger-icon span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: white;
            transition: all 0.3s cubic-bezier(.08,.82,.17,1);
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(1) {
            transform: translateY(8px) rotate(45deg);
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(2) {
            opacity: 0;
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg);
        }
        .mobile-menu-link:hover {
            background-color: #000000;
        }

        /* This is the sliding highlighter for the desktop menu */
        #desktop-menu-items {
            position: relative; 
        }
        #sliding-highlighter {
            position: absolute;
            top: 0;
            left: 0;
            width: 0; /* Hidden by default */
            height: 100%;
            background-color: #492833;
            border-radius: 0.375rem;
            transition: left 0.3s ease-in-out, width 0.3s ease-in-out;
            z-index: 0; 
        }

        /* Styles for the race results table */
        .race-table th {
            background-color: #382028;
            color: #ffffff;
            padding: 0.75rem 1rem;
            font-weight: 600;
            font-size: 0.875rem;
            border-bottom: 1px solid #4a4a4a;
            text-transform: uppercase;
        }
        .race-table td {
            padding: 0.75rem 1rem;
            color: #d1d5db;
            border-bottom: 1px solid #554146;
            vertical-align: middle;
        }
        .race-table tr:nth-child(odd) {
            background-color: #492833;
        }
        .race-table tr:nth-child(even) {
            background-color: #3e242d;
        }
        .race-table tr:hover {
            background-color: #554146;
        }
        .race-table .pos-number, .race-table .grid-number {
            color: #ffffff;
            font-weight: 700;
        }

        .footer {
            background-color: #492833;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }
    </style>
</head>
<body class="font-medium">

    <!-- Header Section -->
    <header class="bg-black/70 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0">
                    <a href="/index.html">
                        <img src="/images/10c.png" class="h-10" alt="10 Controls Logo" onerror="this.onerror=null;this.src='https://placehold.co/160x40/492833/FFFFFF?text=Logo';">
                    </a>
                </div>

                <div id="desktop-menu-items" class="hidden md:flex items-center space-x-4">
                    <div id="sliding-highlighter"></div>
                    <a href="/index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Latest</a>
                    <a href="/schedule.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Schedule</a>
                    <a href="/standings.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Standings</a>
                    <a href="/teams.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Teams</a>
                </div>

                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-white focus:outline-none" style="background-color: #492833;">
                        <span class="sr-only">Open main menu</span>
                        <div class="hamburger-icon space-y-1.5">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                </div>
            </div>
        </nav>
        
        <div class="md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/index.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Latest</a>
                <a href="/schedule.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Schedule</a>
                <a href="/standings.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Standings</a>
                <a href="/teams.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Teams</a>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="relative max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 w-full">
        <div class="flex items-center mb-6">
            <img id="race-flag" src="" alt="Race Flag" class="h-12 w-12 mr-4 rounded-md object-cover">
            <h1 id="main-title" class="text-2xl sm:text-3xl font-bold text-white"></h1>
        </div>
        <p id="race-details" class="text-sm text-white mb-8"></p>
        
        <div class="flex justify-end mb-6">
            <div id="pole-time-box" class="bg-[#382028] px-4 py-2 rounded-lg shadow-lg hidden max-w-xs w-full">
                <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-1">Pole Time</h3>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <img id="pole-driver-flag" src="" alt="Driver Flag" class="h-5 mr-3 rounded-sm">
                        <span id="pole-driver-name" class="text-white font-bold text-lg"></span>
                    </div>
                    <span id="pole-time" class="text-white font-bold text-2xl"></span>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto rounded-lg shadow-lg">
            <table class="min-w-full divide-y divide-gray-700 race-table table-fixed w-full">
                <thead>
                    <tr>
                        <!-- Table headers are added by JavaScript -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" class="text-center p-8">Loading race data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black text-white text-center py-5 px-2">
        <div class="max-w-7xl mx-auto flex justify-center items-center space-x-6">
            <a href="https://www.twitch.tv/10controls" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="Twitch"><i class="fab fa-twitch fa-lg"></i></a>
            <a href="https://www.instagram.com/10controls/" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="Instagram"><i class="fab fa-instagram fa-lg"></i></a>
            <a href="https://www.youtube.com/@10controls24" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="YouTube"><i class="fab fa-youtube fa-lg"></i></a>
        </div>
    </footer>

    <footer class="footer">
        <p>Â© 2022-2025 10 Controls Limited</p>
    </footer>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

    <script>
    (function() {
        // Your Firebase configuration details
        const firebaseConfig = {
            apiKey: "AIzaSyBh04SK_R2zHZcClvyoWqOXkRO1Y6gqApw",
            authDomain: "controls-69f13.firebaseapp.com",
            projectId: "controls-69f13",
            storageBucket: "controls-69f13.firebasestorage.app",
            messagingSenderId: "117480410654",
            appId: "1:117480410654:web:64db25ec7ae0f15d16a80f",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            // This handles the mobile menu opening and closing
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('menu-open');
                    mobileMenuButton.classList.toggle('open');
                });
            }

            // This script makes the desktop menu highlighter follow your mouse
            const menuItemsContainer = document.getElementById('desktop-menu-items');
            if (menuItemsContainer) {
                const menuLinks = menuItemsContainer.querySelectorAll('a');
                const highlighter = document.getElementById('sliding-highlighter');

                function moveHighlighterToLink(link) {
                    if (!highlighter) return;

                    if (!link) {
                        // Hides the highlighter when the mouse leaves the menu
                        highlighter.style.width = '0px';
                    } else {
                        // Moves the highlighter to the link being hovered over
                        highlighter.style.left = `${link.offsetLeft}px`;
                        highlighter.style.width = `${link.offsetWidth}px`;
                    }
                }

                menuLinks.forEach(link => {
                    link.addEventListener('mouseenter', () => moveHighlighterToLink(link));
                });

                menuItemsContainer.addEventListener('mouseleave', () => {
                    moveHighlighterToLink(null);
                });
            }
            
            // This section fetches and displays the race data from Firebase
            const raceId = "brazil"; 
            const raceDocRef = db.collection("races").doc(raceId);

            const mainTitle = document.getElementById('main-title');
            const raceDetails = document.getElementById('race-details');
            const raceFlag = document.getElementById('race-flag');
            const tableHeadRow = document.querySelector('.race-table thead tr');
            const tableBody = document.querySelector('.race-table tbody');
            const poleTimeBox = document.getElementById('pole-time-box');
            const poleDriverFlagEl = document.getElementById('pole-driver-flag');
            const poleDriverNameEl = document.getElementById('pole-driver-name');
            const poleTimeEl = document.getElementById('pole-time');

            async function fetchRaceInfo() {
                try {
                    const doc = await raceDocRef.get();
                    if (doc.exists) {
                        const data = doc.data();
                        mainTitle.innerHTML = `${data.name.toUpperCase()} - <br class="sm:hidden">RACE RESULT`;
                        raceDetails.textContent = `${data.date.toUpperCase()} | ${data.venue.toUpperCase()}`;
                        raceFlag.src = `https://flagsapi.com/${data.flag.toUpperCase()}/flat/64.png`;
                        raceFlag.onerror = () => { raceFlag.src = 'https://placehold.co/64x64/492833/FFFFFF?text=FLAG'; };

                        if (data.poleDriver && data.poleTime && data.poleDriverFlag) {
                            poleDriverFlagEl.src = `https://flagsapi.com/${data.poleDriverFlag.toUpperCase()}/flat/64.png`;
                            poleDriverFlagEl.onerror = () => { poleDriverFlagEl.style.display = 'none'; };
                            poleDriverNameEl.textContent = data.poleDriver.toUpperCase();
                            poleTimeEl.textContent = data.poleTime;
                            poleTimeBox.classList.remove('hidden');
                        }

                    } else {
                        mainTitle.textContent = "RACE NOT FOUND";
                        console.error("Race document not found for ID:", raceId);
                    }
                } catch (error) {
                    console.error("Error fetching race info: ", error);
                    mainTitle.textContent = "ERROR LOADING DATA";
                }
            }

            async function fetchResults(subcollectionName) {
                const results = [];
                const querySnapshot = await raceDocRef.collection(subcollectionName).orderBy("pos").get();
                querySnapshot.forEach((doc) => {
                    results.push(doc.data());
                });
                return results;
            }

            const raceHeaders = [
                { text: 'POS', key: 'pos', classes: 'w-[10%] py-3.5 pl-4 pr-3 text-left text-sm font-semibold' },
                { text: 'GRID', key: 'grid', classes: 'w-[10%] py-3.5 pl-4 pr-3 text-left text-sm font-semibold' },
                { text: 'DRIVER', key: 'driver', classes: 'w-[35%] px-3 py-3.5 text-left text-sm font-semibold' },
                { text: 'TEAM', key: 'team', classes: 'w-[35%] px-3 py-3.5 text-left text-sm font-semibold hidden md:table-cell' },
                { text: 'PTS', key: 'pts', classes: 'w-[10%] py-3.5 pl-3 pr-4 text-right text-sm font-semibold' }
            ];
            
            const teamLogos = {
                "HOT WHEELS MCLAREN": 'https://cdn.discordapp.com/emojis/1378699086982811679.webp',
                "NEWPORT ROLEX RED BULL": 'https://cdn.discordapp.com/emojis/1378696277180813312.webp',
                "GUINNESS MERCEDES": 'https://cdn.discordapp.com/emojis/1386054950496243732.webp',
                "PIRELLI FERRARI": 'https://cdn.discordapp.com/emojis/1390804647492583434.webp',
                "LOCKHEED MARTIN ASTON MARTIN": 'https://cdn.discordapp.com/emojis/1215769484078354483.webp',
                "BMW WILLIAMS": 'https://cdn.discordapp.com/emojis/1401529008956510308.webp',
                "JOHN DEERE WILLIAMS RACING": 'https://cdn.discordapp.com/emojis/1377791374341963917.webp',
                "VOLKSWAGEN SAUBER": 'https://cdn.discordapp.com/emojis/1401621390448394290.webp',
                "HONDA ALPINE": 'https://cdn.discordapp.com/emojis/1401669533256646746.webp',
                "RACING BULLS PEUGEOT SPORT": 'https://cdn.discordapp.com/emojis/1215769209477075025.webp',
                "HAAS ONLYFANS RACING": 'https://cdn.discordapp.com/emojis/1215769147573174313.webp',
                "TWITCH SAUBER": 'https://cdn.discordapp.com/emojis/1379957079900688515.webp',
                "TINDER ALPINE F1 TEAM": 'https://cdn.discordapp.com/emojis/1379862213493260328.webp'
            };

            function renderTable(data) {
                if (!tableHeadRow || !tableBody) return;
                
                tableHeadRow.innerHTML = '';
                tableBody.innerHTML = '';

                raceHeaders.forEach(header => {
                    const th = document.createElement('th');
                    th.className = header.classes;
                    th.textContent = header.text;
                    tableHeadRow.appendChild(th);
                });

                if (!data || data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="${raceHeaders.length}" class="text-center p-8">No race data available.</td></tr>`;
                    return;
                }

                data.forEach(rowData => {
                    const tr = document.createElement('tr');
                    raceHeaders.forEach(header => {
                        const td = document.createElement('td');
                        const tdBaseClasses = header.classes.replace(/w-\[\d+%\]/g, '').replace(/w-\d+\/\d+/g, '');
                        td.className = tdBaseClasses.replace('font-semibold', '') + ' whitespace-nowrap';
                        
                        if (header.key === 'pos') td.classList.add('pos-number');
                        if (header.key === 'grid') td.classList.add('grid-number');

                        const cellValue = rowData[header.key] || 'N/A';
                        
                        if (header.key === 'driver' && rowData.flag) {
                            td.innerHTML = `<img src="https://flagsapi.com/${rowData.flag.toUpperCase()}/flat/16.png" alt="${rowData.flag}" class="inline-block mr-2 h-4 rounded-sm" onerror="this.style.display='none'"> ${cellValue}`;
                        } else if (header.key === 'team') {
                            const logoUrl = teamLogos[cellValue.toUpperCase()];
                            if (logoUrl) {
                                td.innerHTML = `<div class="flex items-center"><img src="${logoUrl}" alt="${cellValue} logo" class="h-6 w-6 mr-3 inline-block object-contain"> ${cellValue}</div>`;
                            } else {
                                td.textContent = cellValue;
                            }
                        } else {
                            td.textContent = cellValue;
                        }
                        
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });
            }

            // This function runs once when the page loads to get everything started
            async function initialLoad() {
                await fetchRaceInfo();
                tableBody.innerHTML = `<tr><td colspan="${raceHeaders.length}" class="text-center p-8">Fetching race data...</td></tr>`;
                const raceData = await fetchResults("raceResults");
                renderTable(raceData);
            }
            
            initialLoad();
        });
    })();
    </script>
</body>
</html>
